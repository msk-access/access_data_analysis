# Table of Contents

- [Table of Contents](#table-of-contents)
- [run\_create\_report](#run_create_report)
      - [main](#main)
- [check\_required\_columns](#check_required_columns)
      - [check\_required\_columns](#check_required_columns-1)
- [generate\_repo\_paths](#generate_repo_paths)
      - [generate\_repo\_path](#generate_repo_path)
- [read\_manifest](#read_manifest)
      - [read\_manifest](#read_manifest-1)
- [get\_small\_variant\_csv](#get_small_variant_csv)
      - [get\_small\_variant\_csv](#get_small_variant_csv-1)
- [run\_cmd](#run_cmd)
      - [run\_cmd](#run_cmd-1)
      - [run\_multiple\_cmd](#run_multiple_cmd)
- [generate\_facet\_maf\_path](#generate_facet_maf_path)
      - [generate\_facet\_maf\_path](#generate_facet_maf_path-1)
- [generate\_create\_report\_cmd](#generate_create_report_cmd)
      - [generate\_create\_report\_cmd](#generate_create_report_cmd-1)

<a id="run_create_report"></a>

# run\_create\_report

<a id="run_create_report.main"></a>

#### main

```bash
Usage: run_create_report.py [OPTIONS]

  Wrapper script to run create_report.R

  Args:     repo_path (Path, optional): "Base path to where the git
  repository is located for access_data_analysis".     script_path (Path,
  optional): "Path to the create_report.R script, fall back if `--repo` is
  not given".     template_path (Path, optional): "Path to the template.Rmd
  or template_days.Rmd to be used with create_report.R when `--repo` is not
  given".     manifest (Path, required): "File containing meta information
  per sample.".     variant_path (Path, required): "Base path for all
  results of small variants as generated by filter_calls.R script in
  access_data_analysis (Make sure only High Confidence calls are included)".
  cnv_path (Path, required): "Base path for all results of CNV as generated
  by CNV_processing.R script in access_data_analysis".     facet_repo (Path,
  required): "Base path for all results of facets on Clinical MSK-IMPACT
  samples".     tumor_type (str, optional): "Tumor type label for the
  report".     copy_facet (bool, optional): "If this is set to True then we
  will copy the facet maf file in the directory specified in
  `copy_facet_dir`".     copy_facet_dir (Path, optional): "Directory path
  where the facet maf file should be copied.".     template_days (bool,
  optional): "If the `--repo` option is specified and if this is set to True
  then we will use the template_days RMarkdown file as the template".
  markdown (bool, optional): "If given, the create_report.R will be run with
  `-md` flag to generate markdown".

Options:
  -r, --repo PATH                 Base path to where the git repository is
                                  located for access_data_analysis

  -s, --script PATH               Path to the create_report.R script, fall
                                  back if `--repo` is not given

  -t, --template PATH             Path to the template.Rmd or
                                  template_days.Rmd to be used with
                                  create_report.R when `--repo` is not given

  -m, --manifest FILE             File containing meta information per sample.
                                  [required]

  -v, --variant-results DIRECTORY
                                  Base path for all results of small variants
                                  as generated by filter_calls.R script in
                                  access_data_analysis (Make sure only High
                                  Confidence calls are included)  [required]

  -c, --cnv-results DIRECTORY     Base path for all results of CNV as
                                  generated by CNV_processing.R script in
                                  access_data_analysis  [required]

  -f, --facet-repo DIRECTORY      Base path for all results of facets on
                                  Clinical MSK-IMPACT samples  [default: /juno
                                  /work/ccs/shared/resources/impact/facets/all
                                  /]

  -l, --tumor-type TEXT           Tumor type label for the report  [default: ]
  -cfm, --copy-facet-maf          If this is set to True then we will copy the
                                  facet maf file in the directory specified in
                                  `copy_facet_dir`  [default: False]

  -cfd, --copy-facet-dir PATH     Directory path where the facet maf file
                                  should be copied.

  -d, --template-days             If the `--repo` option is specified and if
                                  this is set to True then we will use the
                                  template_days RMarkdown file as the template
                                  [default: False]

  -gm, --generate-markdown        If given, the create_report.R will be run
                                  with `-md` flag to generate markdown
                                  [default: False]

  --install-completion            Install completion for the current shell.
  --show-completion               Show completion for the current shell, to
                                  copy it or customize the installation.

  --help                          Show this message and exit.
```

Wrapper script to run create_report.R

**Arguments**:

- `repo_path` _Path, optional_ - "Base path to where the git repository is located for access_data_analysis".
- `script_path` _Path, optional_ - "Path to the create_report.R script, fall back if `--repo` is not given".
- `template_path` _Path, optional_ - "Path to the template.Rmd or template_days.Rmd to be used with create_report.R when `--repo` is not given".
- `manifest` _Path, required_ - "File containing meta information per sample.".
- `variant_path` _Path, required_ - "Base path for all results of small variants as generated by filter_calls.R script in access_data_analysis (Make sure only High Confidence calls are included)".
- `cnv_path` _Path, required_ - "Base path for all results of CNV as generated by CNV_processing.R script in access_data_analysis".
- `facet_repo` _Path, required_ - "Base path for all results of facets on Clinical MSK-IMPACT samples".
- `tumor_type` _str, optional_ - "Tumor type label for the report".
- `copy_facet` _bool, optional_ - "If this is set to True then we will copy the facet maf file in the directory specified in `copy_facet_dir`".
- `copy_facet_dir` _Path, optional_ - "Directory path where the facet maf file should be copied.".
- `template_days` _bool, optional_ - "If the `--repo` option is specified and if this is set to True then we will use the template_days RMarkdown file as the template".
- `markdown` _bool, optional_ - "If given, the create_report.R will be run with `-md` flag to generate markdown".

<a id="check_required_columns"></a>

# check\_required\_columns

<a id="check_required_columns.check_required_columns"></a>

#### check\_required\_columns

```python
def check_required_columns(manifest, template_days=None)
```

Check if all required columns are present in the sample manifest file

**Arguments**:

- `manifest` _data_frame_ - meta information file with information for each sample
- `template_days` _bool_ - True|False if template days RMarkdown will be used
  

**Raises**:

- `typer.Abort` - if "cmo_patient_id" column not provided
- `typer.Abort` - if "cmo_sample_id/sample_id" column not provided
- `typer.Abort` - if "dmp_patient_id" column not provided
- `typer.Abort` - if "collection_date/collection_day" column not provided
- `typer.Abort` - if "timepoint" column not provided
  

**Returns**:

- `list` - column name for the manifest file

<a id="generate_repo_paths"></a>

# generate\_repo\_paths

<a id="generate_repo_paths.generate_repo_path"></a>

#### generate\_repo\_path

```python
def generate_repo_path(repo_path=None, script_path=None, template_path=None, template_days=None)
```

Generate path to create_report.R and template RMarkdown file

**Arguments**:

- `repo_path` _pathlib.Path, optional_ - Path to clone of git repo access_data_analysis. Defaults to None.
- `script_path` _pathlib.Path, optional_ - Path to create_report.R. Defaults to None.
- `template_path` _pathlib.Path, optional_ - Path to template RMarkdown file. Defaults to None.
- `template_days` _bool, optional_ - True|False to use days template if using repo_path. Defaults to None.
  

**Raises**:

- `typer.Abort` - Abort if both repo_path and script_path are not given
- `typer.Abort` - Abort if both repo_path and template_path are not given
  

**Returns**:

- `str` - Path to create_report.R and path to template markdown file

<a id="read_manifest"></a>

# read\_manifest

<a id="read_manifest.read_manifest"></a>

#### read\_manifest

```python
def read_manifest(manifest)
```

_summary_

**Arguments**:

- `manifest` _pathlib.PATH_ - _description_
  

**Returns**:

- `data_frame` - _description_

<a id="get_small_variant_csv"></a>

# get\_small\_variant\_csv

<a id="get_small_variant_csv.get_small_variant_csv"></a>

#### get\_small\_variant\_csv

```python
def get_small_variant_csv(patient_id, csv_path)
```

Get the path to CSV file to be used for a given patient containing all variants

**Arguments**:

- `patient_id` _str_ - patient id used to identify the csv file
- `csv_path` _pathlib.path_ - base path where the csv file is expected to be present
  

**Raises**:

- `typer.Abort` - if no csv file is returned
- `typer.Abort` - if more then one csv file is returned
  

**Returns**:

- `str` - path to csv file containing the variants

<a id="run_cmd"></a>

# run\_cmd

<a id="run_cmd.run_cmd"></a>

#### run\_cmd

```python
def run_cmd(cmd)
```

Given a system command run it using subprocess

**Arguments**:

- `cmd` _str_ - System command to be run as a string

<a id="run_cmd.run_multiple_cmd"></a>

#### run\_multiple\_cmd

```python
def run_multiple_cmd(commands, parallel_process=None)
```

Given a system command run it using subprocess

**Arguments**:

- `cmd` _list[str]_ - list of system commands to be run

<a id="generate_facet_maf_path"></a>

# generate\_facet\_maf\_path

<a id="generate_facet_maf_path.generate_facet_maf_path"></a>

#### generate\_facet\_maf\_path

```python
def generate_facet_maf_path(facet_path, patient_id, sample_id=None)
```

Get path of maf associated with facet-suite output

**Arguments**:

- `facet_path` _pathlib.PATH|str_ - path to search for the facet file
- `patient_id` _str_ - patient id to be used to search, default is set to None
- `sample_id` _str_ - sample id to be used to search, default is set to None
  

**Returns**:

- `str` - path of the facets maf

<a id="generate_create_report_cmd"></a>

# generate\_create\_report\_cmd

<a id="generate_create_report_cmd.generate_create_report_cmd"></a>

#### generate\_create\_report\_cmd

```python
def generate_create_report_cmd(script, markdown, template_file, cmo_patient_id, csv_file, manifest, cnv_path, dmp_patient_id, dmp_sample_id, dmp_facet_maf, tumor_type=None)
```

Create the system command that should be run for create_report.R

**Arguments**:

- `script` _str_ - path for create_report.R
- `markdown` _bool_ - True|False to generate markdown output
- `template_file` _str_ - path for the template file
- `cmo_patient_id` _str_ - patient id from CMO
- `csv_file` _str_ - path to csv file containing variant information
- `tumor_type` _str_ - tumor type label
- `manifest` _pathlib.Path_ - path to the manifest containing meta data
- `cnv_path` _pathlib.Path_ - path to directory having cnv files
- `dmp_patient_id` _str_ - patient id of the clinical msk-impact sample
- `dmp_sample_id` _str_ - sample id of the clinical msk-impact sample
- `dmp_facet_maf` _str_ - path to the clinical msk-impact maf file annotated for facets results
  

**Returns**:

- `cmd` _str_ - system command to run for create_report.R
- `html_output` _pathlib.Path_ - where the output file should be written

